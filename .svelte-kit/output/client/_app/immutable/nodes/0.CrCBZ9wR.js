import{e as E,a as _,t as h,s as L,c as ie}from"../chunks/disclose-version.COp2Sx5X.js";import{i as Y}from"../chunks/legacy.C6dZd77_.js";import{C as oe,G as ne,q as Z,ax as te,ay as ae,v as i,w as t,x as e,t as G,e as r,i as n,r as ee,z as y,ak as le,az as de,A as re,aA as ve}from"../chunks/runtime.DExCUZGw.js";import{i as S}from"../chunks/preload-helper.DocKlGQB.js";import{s as ce}from"../chunks/event-modifiers.Bfc47y5P.js";import{s as me,a as ue}from"../chunks/store._3t7VsMo.js";import{b as fe,p as pe}from"../chunks/stores.D1wLCwxb.js";import{s as $}from"../chunks/supabase.BhBeyELt.js";import{c as ge,o as _e}from"../chunks/index-client.BmxZP1LF.js";import{g as be}from"../chunks/entry.CED2JQsL.js";import{p as X}from"../chunks/props.BJwpzjIc.js";import{e as xe,i as he}from"../chunks/each.DPzY1_RN.js";import{r as we,b as ye}from"../chunks/input.DoOhNRNz.js";function ke(O,f,p,u,w){var g;oe&&ne();var l=(g=f.$$slots)==null?void 0:g[p],v=!1;l===!0&&(l=f.children,v=!0),l===void 0||l(O,v?()=>u:u)}var Ce=h('<p class="text-sm text-red-600"> </p>'),Ie=h('<p class="text-sm text-green-600"> </p>'),Ee=h('<div class="mt-2"><!> <!></div>'),Me=h('<div class="flex items-center justify-between bg-gray-50 px-4 py-3 rounded-lg"><div class="flex flex-col"><span class="text-sm font-medium text-gray-900"> </span> <span class="text-xs text-gray-500 capitalize"> </span></div> <button class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Remove</button></div>'),qe=h('<div class="mt-8"><h3 class="text-lg font-medium text-gray-900 mb-4">Current Collaborators</h3> <div class="space-y-3"></div></div>'),ze=h(`<div class="p-6"><h2 class="text-lg font-semibold text-gray-900 mb-4">Invite Collaborators</h2> <div class="space-y-6"><div class="bg-white rounded-lg"><div class="space-y-4"><div><label for="invite-email" class="block text-sm font-medium text-gray-700">Email address</label> <input id="invite-email" type="email" placeholder="Enter collaborator's email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></div> <div><label for="invite-role" class="block text-sm font-medium text-gray-700">Access Level</label> <select id="invite-role" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"><option>Viewer (can only view)</option><option>Editor (can edit)</option></select></div> <!> <button type="button" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Send Invitation</button></div></div> <!></div></div>`);function Se(O,f){Z(f,!1);let p=X(f,"mindmapId",8),u=y(""),w=y("editor"),l=y(""),v=y(""),g=y([]);async function b(){const{data:s,error:c}=await $.from("mindmap_collaborators").select(`
        *,
        user:user_id (
          email
        )
      `).eq("mindmap_id",p());s&&n(g,s)}async function k(){n(l,""),n(v,"");const{data:s,error:c}=await $.from("profiles").select("id").eq("email",r(u)).single();if(c||!s){n(l,"User not found. They need to register first.");return}const{data:C}=await $.from("mindmap_collaborators").select().match({mindmap_id:p(),user_id:s.id}).single();if(C){n(l,"User is already a collaborator");return}const{error:q}=await $.from("mindmap_collaborators").insert({mindmap_id:p(),user_id:s.id,role:r(w)});q?n(l,q.message):(n(v,"User invited successfully!"),n(u,""),await b())}async function x(s){const{error:c}=await $.from("mindmap_collaborators").delete().match({mindmap_id:p(),user_id:s});c?n(l,c.message):await b()}te(()=>le(p()),()=>{p()&&b()}),ae(),Y();var M=ze(),U=i(t(M),2),j=t(U),A=t(j),B=t(A),R=i(t(B),2);we(R),e(B);var D=i(B,2),T=i(t(D),2);G(()=>{r(w),de(()=>{})});var V=t(T);V.value=(V.__value="viewer")==null?"":"viewer";var W=i(V);W.value=(W.__value="editor")==null?"":"editor",e(T),e(D);var F=i(D,2);{var P=s=>{var c=Ee(),C=t(c);{var q=d=>{var m=Ce(),I=t(m,!0);e(m),G(()=>L(I,r(l))),_(d,m)};S(C,d=>{r(l)&&d(q)})}var a=i(C,2);{var o=d=>{var m=Ie(),I=t(m,!0);e(m),G(()=>L(I,r(v))),_(d,m)};S(a,d=>{r(v)&&d(o)})}e(c),_(s,c)};S(F,s=>{(r(l)||r(v))&&s(P)})}var J=i(F,2);e(A),e(j);var N=i(j,2);{var Q=s=>{var c=qe(),C=i(t(c),2);xe(C,5,()=>r(g),he,(q,a)=>{var o=Me(),d=t(o),m=t(d),I=t(m,!0);e(m);var z=i(m,2),H=t(z,!0);e(z),e(d);var K=i(d,2);e(o),G(()=>{L(I,r(a).user.email),L(H,r(a).role)}),E("click",K,()=>x(r(a).user_id)),_(q,o)}),e(C),e(c),_(s,c)};S(N,s=>{r(g).length>0&&s(Q)})}e(U),e(M),ye(R,()=>r(u),s=>n(u,s)),fe(T,()=>r(w),s=>n(w,s)),E("click",J,k),_(O,M),ee()}var Oe=h('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="modal-content relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"><!></div></div>');function Ue(O,f){Z(f,!1);let p=X(f,"mindmapId",8),u=X(f,"show",8,!1);const w=ge();function l(k){const x=document.querySelector(".modal-content");x&&!x.contains(k.target)&&w("close")}Y();var v=ie(),g=re(v);{var b=k=>{var x=Oe(),M=t(x),U=t(M);Se(U,{get mindmapId(){return p()}}),e(M),e(x),E("click",x,l),_(k,x)};S(g,k=>{u()&&k(b)})}_(O,v),ee()}var je=h('<div id="logo-dropdown" class="absolute left-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50 svelte-1af0y5q"><div class="py-1"><button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Share Mindmap</button></div></div>'),De=h('<div class="relative svelte-1af0y5q"><button class="inline-flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button> <!></div>'),$e=h('<div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 svelte-1af0y5q"><div class="px-4 py-2 text-sm text-gray-700 border-b">Signed in as<br> <span class="font-medium"> </span></div> <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sign out</button></div>'),Ae=h('<div class="min-h-screen bg-gray-100"><nav class="bg-white shadow"><div class="max-w-7xl mx-auto px-4"><div class="flex justify-between h-16"><div class="flex items-center space-x-4"><a href="/" class="flex items-center"><span class="text-xl font-bold text-indigo-600">MindMap</span></a> <!></div> <div class="flex items-center"><div class="relative svelte-1af0y5q"><button class="flex items-center space-x-2 hover:bg-gray-100 px-3 py-2 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <span class="text-sm text-gray-700"> </span></button> <!></div></div></div></div></nav> <main><!></main></div> <!>',1);function Qe(O,f){Z(f,!1);const p=me(),u=()=>ue(pe,"$page",p),w=y();let l=y(""),v=y(!1),g=y(!1),b=y(!1);_e(async()=>{var o;const{data:{session:a}}=await $.auth.getSession();n(l,((o=a==null?void 0:a.user)==null?void 0:o.email)||"")});async function k(){try{const{error:a}=await $.auth.signOut();if(a)throw a;await be("/login")}catch(a){console.error("Error signing out:",a)}}function x(){n(b,!r(b))}function M(a){const o=document.getElementById("logo-dropdown");o&&!o.contains(a.target)&&n(b,!1)}te(()=>u(),()=>{n(w,u().url.pathname.startsWith("/mindmaps/"))}),ae(),Y();var U=Ae();E("click",ve,M);var j=re(U),A=t(j),B=t(A),R=t(B),D=t(R),T=i(t(D),2);{var V=a=>{var o=De(),d=t(o),m=i(d,2);{var I=z=>{var H=je(),K=t(H),se=t(K);e(K),e(H),E("click",se,()=>{n(g,!0),n(b,!1)}),_(z,H)};S(m,z=>{r(b)&&z(I)})}e(o),E("click",d,ce(x)),_(a,o)};S(T,a=>{r(w)&&a(V)})}e(D);var W=i(D,2),F=t(W),P=t(F),J=i(t(P),2),N=t(J,!0);e(J),e(P);var Q=i(P,2);{var s=a=>{var o=$e(),d=t(o),m=i(t(d),3),I=t(m,!0);e(m),e(d);var z=i(d,2);e(o),G(()=>L(I,r(l))),E("click",z,k),E("mouseleave",o,()=>n(v,!1)),_(a,o)};S(Q,a=>{r(v)&&a(s)})}e(F),e(W),e(R),e(B),e(A);var c=i(A,2),C=t(c);ke(C,f,"default",{}),e(c),e(j);var q=i(j,2);Ue(q,{get mindmapId(){return u().params.id},get show(){return r(g)},$$events:{close:()=>n(g,!1)}}),G(()=>L(N,r(l))),E("click",P,()=>n(v,!r(v))),_(O,U),ee()}export{Qe as component};
